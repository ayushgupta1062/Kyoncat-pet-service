{% extends 'website/base.html' %}
{% load static %}
{% block title %}Make an Appointment{% endblock %}
{% block keyword %}{% endblock %}
{% block description %}{% endblock %}
{% block css %}
<style>
.pet-type-options {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 300px;
  overflow-y: auto;
  padding: 8px;
}
.pet-card {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  padding: 16px 12px;
  border: 2px solid #e5e5e5;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  min-height: 180px;
}
.pet-card:hover {
  border-color: #ff8a3d;
  box-shadow: 0 4px 12px rgba(255, 138, 61, 0.2);
  transform: translateY(-2px);
}
.pet-card.selected {
  border-color: #ff8a3d;
  background: linear-gradient(135deg, rgba(255, 138, 61, 0.08) 0%, rgba(255, 138, 61, 0.03) 100%);
  box-shadow: 0 6px 20px rgba(255, 138, 61, 0.3);
  transform: translateY(-2px);
}
.pet-label { display: none; }
.pet-thumb-img {
  width: 100%;
  max-width: 140px;
  height: 140px;
  border-radius: 8px;
  border: 2px solid #e5e5e5;
  transition: all 0.3s ease;
  object-fit: contain;
  background: #f9f9f9;
  display: block;
  margin: 0 auto;
  padding: 8px;
}
.pet-card.selected .pet-thumb-img {
  border-color: #ff8a3d;
  box-shadow: 0 4px 12px rgba(255, 138, 61, 0.25);
  transform: scale(1.05);
}
.pet-card:hover .pet-thumb-img {
  border-color: #ff8a3d;
}
/* Custom scrollbar for dropdown */
.pet-type-options::-webkit-scrollbar {
  width: 6px;
}
.pet-type-options::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}
.pet-type-options::-webkit-scrollbar-thumb {
  background: #ff8a3d;
  border-radius: 10px;
}
.pet-type-options::-webkit-scrollbar-thumb:hover {
  background: #e6792a;
}
</style>
{% endblock %}
{% block content %}

{% include 'website/header.html' %}

<section class="sab-banner-wraper" style="padding: 42px 0px 190px 0px;">
  <div class="custom-shape-divider-bottom-1687358784">
    <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
      <path
        d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
        opacity=".25" class="shape-fill"></path>
      <path
        d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z"
        opacity=".5" class="shape-fill"></path>
      <path
        d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"
        class="shape-fill"></path>
    </svg>
  </div>
</section>

<section class="pet_appointment_wrap">
  <div class="container bgc1" style="padding: 5rem;">
    <h4 class="appointment-main-title">Make an Appointment </h4>
    {% if messages %}
      {% for message in messages %}
        <div class="bg-info panel-heading">
          {{message}}
        </div>
        <hr>    
      {% endfor %}
    {% endif %}

    <div class="row">
      <form method="POST" class="col-lg-8"> {% csrf_token %}
        <div class="row">
          <div class="col-md-6 col-lg-4">
            <h6>Available Services<span class="text-danger">*</span></h6>
            <div class="">
              <select class="small" required name="service" id="serviceSelect">
                <option value="" selected disabled>Select Service</option>
                {% for data in service %}
                {% if data.packages.all %}
                <optgroup label="{{data.title}}">
                  {% for package in data.packages.all %}
                  <option value="{{data.title}} - {{package.name}}" data-price="{{package.price|default:'0'}}" {% if request.GET.id|add:'0' == package.id|add:'0' %}selected{% endif %}>{{data.title}} - {{package.name}}</option>
                  {% endfor %}
                </optgroup>
                {% else %}                
                <option value="{{data.title}}" data-id="{{data.id}}" data-price="0" {% if request.GET.service|add:'0' == data.id|add:'0' %}selected{% endif %}>{{data.title}}</option>
                {% endif %}
                {% endfor %}
              </select>
            </div>
            <input type="hidden" name="amount" id="amountField" value="0">
          </div>
          <div class="col-md-6 col-lg-4">
            <h6>Date<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="date" name="date" required type="date">
            </div>
          </div>
          <div class="col-md-6 col-lg-4">
            <h6>Time<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="time" name="time" required type="time">
            </div>            
          </div>  
          <div class="col-lg-12 col-12"><small class="text-danger">Selected time slots are not guaranteed. Our executive will call you to confirm or update your appointmentÂ timing.</small></div>        
        </div>
        <br>
        <h4>Pet Details</h4>
        
        <div class="row">
          <div class="col-md-6 col-lg-4">
            <h6>Pet Type<span class="text-danger">*</span></h6>
            <div class="">
              <!-- keep original select for form compatibility -->
              <select name="pet_type" required style="position:absolute; left:-9999px; width:1px; height:1px;">
                <option value="" selected disabled>Select Pet Type</option>
                <option value="Dog">Dog</option>
                <option value="Cat">Cat</option>
              </select>
              <!-- custom dropdown trigger -->
              <div class="form-control" id="petTypeTrigger" style="display:flex; align-items:center; justify-content:space-between; cursor:pointer; color:#999;">
                <span id="petTypeSelectedText">Select Pet Type</span>
                <span class="fa fa-angle-down"></span>
              </div>
              <!-- dropdown with images - vertical slider -->
              <div id="petTypeDropdown" class="pet-type-options" style="display:none; margin-top:10px;">
                <div class="pet-card" data-value="Dog">
                  <img src="{% static 'website/images/svg pets (1) (1).png' %}" class="pet-thumb-img" alt="Dog">
                  <span class="pet-label">Dog</span>
                </div>
                <div class="pet-card" data-value="Cat">
                  <img src="{% static 'website/images/pet3.png' %}" class="pet-thumb-img" alt="Cat">
                  <span class="pet-label">Cat</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-4">
            <h6>Breed<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="breed" name="breed" required type="text">
            </div>
          </div>
          <div class="col-md-6 col-lg-4">
            <h6>Pet age<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="pet_age" name="pet_age" required type="text">
            </div>
          </div>                   
        </div>
        <br>
        
        <div class="row">
          <div class="col-md-6 col-lg-6">
            <h6>Aggressive<span class="text-danger">*</span></h6>
            <div class="">
              <select class="small" required name="aggressive">
                <option value="" selected disabled>Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
          <div class="col-md-6 col-lg-6">
            <h6>Vaccinations<span class="text-danger">*</span></h6>
            <div class="">
              <select class="small" required name="vaccinations">
                <option value="" selected disabled>Select</option>
                <option value="Completed">Completed</option>
                <option value="Pending">Pending</option>
              </select>
            </div>
          </div>   
        </div>
        <br>

        <h4>Personal Details</h4>
        
        <div class="row">
          <div class="col-md-6 col-lg-4">
            <h6>Name<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="name" name="name" required type="text">
            </div>
          </div>
          <div class="col-md-6 col-lg-4">
            <h6>Mobile Number<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="mobile" name="mobile" required type="number">
            </div>
          </div>      
          <div class="col-md-6 col-lg-4">
            <h6>Email<span class="text-danger">*</span></h6>
            <div class="">
              <input class="form-control" id="email" name="email" value="{{request.user.username|default:''}}" required type="email">
            </div>
          </div>                 
        </div>
        <br>
        
        <div class="row">
          <div class="col-md-6 col-lg-6">
            <h6>Address<span class="text-danger">*</span></h6>
            <div class="">
              <textarea class="form-control" id="address" name="address" required ></textarea>
            </div>
          </div>
          <div class="col-md-6 col-lg-6">
            <h6>Location Link</h6>
            <div class="">
              <textarea class="form-control" id="location_link" name="location_link" ></textarea>
            </div>
          </div>                   
        </div>
        <br>

        <div class="pet_appointment_colum">
          <button type="submit" class="main_button btn2 bdr-clr hover-affect">Book Now</button>
        </div>
      </form>
      <div class="workin_hours col-lg-4">
        <span>Timings</span>
        <h4>WORKING HOURS</h4>
        {{config.opening_hours|safe}}
      </div>
    </div>
  </div>

</section>


{% include 'website/footer.html' %}

{% endblock %}
{% block js %}
<script type="text/javascript">
  (function($){
    $(function(){
      var $trigger = $("#petTypeTrigger");
      var $dropdown = $("#petTypeDropdown");
      var $select = $("select[name='pet_type']");
      var $text = $("#petTypeSelectedText");
      
      // open/close dropdown with a slide animation (like native selects)
      $trigger.on("click", function(){
        $dropdown.stop(true, true).slideToggle(160, function(){
          if($(this).is(":visible")){
            $(this).css("display", "flex"); // ensure flex layout when visible
          }
        });
      });
      
      // choose pet by clicking an image card
      $dropdown.on("click", ".pet-card", function(){
        var $clickedCard = $(this);
        var value = $clickedCard.data("value");
        
        // Remove selected class from all cards
        $dropdown.find(".pet-card").removeClass("selected");
        
        // Add selected class to clicked card
        $clickedCard.addClass("selected");
        
        // Update form field
        $select.val(value);
        $text.text(value);
        $text.css("color", "#333");
        
        // Close dropdown after a brief delay to show selection
        setTimeout(function(){
          $dropdown.slideUp(160);
        }, 300);
      });
      
      // Initialize selected state based on current value
      function updateSelectedState(){
        var currentValue = $select.val();
        $dropdown.find(".pet-card").removeClass("selected");
        if(currentValue && currentValue !== ""){
          $dropdown.find(".pet-card[data-value='" + currentValue + "']").addClass("selected");
        }
      }
      
      // Run on dropdown open
      $trigger.on("click", function(){
        setTimeout(updateSelectedState, 170);
      });
      
      // Update trigger text color when value is selected
      $select.on("change", function(){
        if($(this).val() && $(this).val() !== ""){
          $("#petTypeTrigger").css("color", "#333");
        } else {
          $("#petTypeTrigger").css("color", "#999");
        }
      });
      
      // close when clicking outside
      $(document).on("click", function(e){
        if(!$(e.target).closest("#petTypeTrigger, #petTypeDropdown").length){
          $dropdown.slideUp(160);
        }
      });
    });
  })(jQuery);
</script>
<script type="text/javascript">
  (function($){
    function syncAmount(){
      var $opt = $("#serviceSelect option:selected");
      var price = $opt.data("price");
      if(price === undefined || price === null || price === "") price = 0;
      $("#amountField").val(price);
    }
    $(function(){
      syncAmount();
      $("#serviceSelect").on("change", syncAmount);
      
      // Set minimum date to today to prevent selecting past dates
      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
      var yyyy = today.getFullYear();
      var todayStr = yyyy + '-' + mm + '-' + dd;
      $("#date").attr('min', todayStr);
    });
  })(jQuery);
</script>
{% endblock %}